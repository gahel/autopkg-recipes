<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE pkg-info PUBLIC "-//Apple Computer//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist>
<dict>
    <display_name>rclone</display_name>
    <name>rclone</name>
    <version>__VERSION__</version>
    <description>Command-line program to manage files on cloud storage.</description>
    <unattended_install>true</unattended_install>
    <unattended_uninstall>true</unattended_uninstall>
    <catalogs>testing</catalogs>
    <installer_type>pkg</installer_type>
    <minimum_os_version>10.14</minimum_os_version>
    <requires>admin</requires>
    <installcheck_script>
        <script_type>bash</script_type>
        <script>
#!/bin/bash

rcloneVersion=$(rclone -V | grep rclone | cut -d "v" -f2-)
echo "Installed version: $rcloneVersion"

rcloneVersion_GitHub=$(curl -sL https://github.com/rclone/rclone/releases/latest | grep -o 'releases/tag/[v.0-9]*' | tail -1 | cut -d/ -f3 | cut -c2-)

echo "GitHub version: $rcloneVersion_GitHub"


#if [ "$rcloneVersion" == "$rcloneVersion_GitHub" ]; then
#    echo "Same and not different!!"
#fi

rcloneVersion="$(rclone -V | grep rclone | cut -d "v" -f2-)"

if [ "$(printf '%s\n' "$rcloneVersion_GitHub" "$rcloneVersion" | sort -V | head -n1)" = "$rcloneVersion_GitHub" ]; then
        echo "rclone OK ${rcloneVersion_GitHub}"
        exit 0
else
        echo "Nyere rclone tilgjegnelig: ${rcloneVersion_GitHub}"
        exit 1
fi        </script>
    </installcheck_script>
    <installcheck_script_type>preinstall</installcheck_script_type>
    <preinstall_script>
        <script_type>python</script_type>
        <script>
            #!/usr/bin/python
            if 'rclone' in os.popen("/usr/local/bin/rclone --version").read():
                os.system("echo 'rclone already installed.' >> /var/log/munki.log")
                exit(0)
            exit(1)
        </script>
    </preinstall_script>
    <preinstall_script_type>preinstall</preinstall_script_type>
    <install_script>        
        <script_type>bash</script_type>
        <script>
            #!/bin/bash
            echo "Installing rclone..."
            cd /usr/local/bin
            unzip -o -q /path/to/rclone-latest.zip
            /usr/local/bin/rclone --version >> /var/log/munki.log
            exit 0
        </script>
    </install_script>
    <install_script_type>postinstall</install_script_type>
</dict>
</plis>
